<!doctype html><html lang=en><head><title>Service Catalog: Connector · Ioannis Canellos - My Blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Ioannis Canellos"><meta name=description content="The service catalog connector"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Service Catalog: Connector"><meta name=twitter:description content="The service catalog connector"><meta property="og:title" content="Service Catalog: Connector"><meta property="og:description" content="The service catalog connector"><meta property="og:type" content="article"><meta property="og:url" content="https://iocanel.github.io/2018/09/service-catalog-connector/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-09-13T09:50:00+03:00"><meta property="article:modified_time" content="2018-09-13T09:50:00+03:00"><link rel=canonical href=https://iocanel.github.io/2018/09/service-catalog-connector/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.123.6"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Ioannis Canellos - My Blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://iocanel.github.io/2018/09/service-catalog-connector/>Service Catalog: Connector</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-09-13T09:50:00+03:00>September 13, 2018
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div></div></header><div><h2 id=introduction>Introduction
<a class=heading-link href=#introduction><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This is the second post in my series about the <a href=https://svc-cat.io>service catalog</a>. If you haven&rsquo;t done already please read the first post: <a href=http://iocanel.com/2018/09/service-catalog-part-1/>service catalog: introduction</a>.</p><p>In this second post I&rsquo;ll create from scratch a <a href=https://spring.io/projects/spring-boot>spring boot</a> application that exposes a JPA crud via rest.
This application will use a <a href=https://svc-cat.io>service catalog</a> managed <a href=https://www.microsoft.com/en-us/sql-server/sql-server-2017>microsoft sql server</a> database and I will demonstrate how you can automagically connect to it using the <a href=https://github.com/snowdrop/servicecatalog-connector>service catalog connector</a>.</p><h2 id=the-spring-cloud-connector>The spring cloud connector
<a class=heading-link href=#the-spring-cloud-connector><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>There is a <a href=https://cloud.spring.io>spring cloud</a> project called <a href=https://cloud.spring.io/spring-cloud-connectors>spring cloud connectors</a>. This project is all about connecting to cloud managed services. I have been working on an implementation specific to the <a href=https://svc-cat.io>service catalog</a>.
The idea is that you can use the <a href=https://svc-cat.io>service catalog</a> to manage the services and use the <a href=https://github.com/snowdrop/servicecatalog-connector>service catalog connector</a> to transparently connect to it.</p><p>At the moment it supports only relational databases, but support for additional services will be added shortly.</p><h2 id=preparation>Preparation
<a class=heading-link href=#preparation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Most of the preparation has been already performed in the <a href=http://iocanel.com/2018/09/service-catalog-part-1/>previous post</a> but I&rsquo;ll recap:</p><ul><li>Started an <a href=https://openshift.com>openshift</a> cluster.</li><li>Installed the <a href=https://svc-cat.io>service catalog</a>.</li><li>Provisioned a <a href=https://www.microsoft.com/en-us/sql-server/sql-server-2017>microsoft sql server</a> database instance (ironically) called `mymssql`.</li></ul><p>So what&rsquo;s left?</p><p>We need to also configure permissions&mldr;</p><h3 id=allowing-our-app-to-talk-to-the-service-catalog>Allowing our app to talk to the service catalog
<a class=heading-link href=#allowing-our-app-to-talk-to-the-service-catalog><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Out of the box (if we logged in as admins) we can list brokers, service classes, instances and bindings using `svcat`. Unfortunately, this is not the case for our application.
The default service account is not expected to have permissions, so we need to grant them:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc adm policy add-cluster-role-to-user system:openshift:service-catalog:aggregate-to-view system:serviceaccount:myproject:default
</span></span><span style=display:flex><span>oc adm policy add-cluster-role-to-user system:aggregate-to-admin system:serviceaccount:myproject:default
</span></span></code></pre></td></tr></table></div></div><p>The command above granted service catalog view permissions to the default service account of my project (which is literally called `myproject` and its the default project created for us).</p><p>Now, we are ready to move to the actual application.</p><h2 id=the-actual-code>The actual code
<a class=heading-link href=#the-actual-code><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I&rsquo;ll use the <a href=https://spring.io/projects/spring-boot>spring boot</a> cli to generate a jpa rest application:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>spring init -d<span style=color:#81a1c1>=</span>data-jpa,data-rest,sqlserver demo.zip
</span></span></code></pre></td></tr></table></div></div><p>To easily deploy the project into kubernetes/openshift add the fabric8 maven plugin to your pom.xml:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#81a1c1>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#81a1c1>&lt;groupId&gt;</span>io.fabric8<span style=color:#81a1c1>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#81a1c1>&lt;artifactId&gt;</span>fabric8-maven-plugin<span style=color:#81a1c1>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#81a1c1>&lt;version&gt;</span>3.5.40<span style=color:#81a1c1>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#81a1c1>&lt;/plugin&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Now, lets create an entity. How about a `Person`?
Our person will be a simple JPA annotated POJO, with just:</p><ul><li>id</li><li>first name</li><li>last name</li></ul><p>&mldr; and it could look like:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.persistence.Entity</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.persistence.Id</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.persistence.GeneratedValue</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.persistence.GenerationType</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@Entity</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>Person</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>      <span style=color:#d08770>@Id</span>
</span></span><span style=display:flex><span>      <span style=color:#d08770>@GeneratedValue</span><span style=color:#eceff4>(</span>strategy <span style=color:#81a1c1>=</span> GenerationType<span style=color:#eceff4>.</span><span style=color:#8fbcbb>AUTO</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>private</span> Long id<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>private</span> String firstName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>private</span> String lastName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> Long <span style=color:#88c0d0>getId</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>id</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1>void</span> <span style=color:#88c0d0>setId</span><span style=color:#eceff4>(</span>Long id<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>id</span><span style=color:#81a1c1>=</span>id<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getFirstName</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>             <span style=color:#81a1c1;font-weight:700>return</span> firstName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1>void</span> <span style=color:#88c0d0>setFirstname</span><span style=color:#eceff4>(</span>String firstName<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>firstName</span><span style=color:#81a1c1>=</span>firstName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getLastName</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>             <span style=color:#81a1c1;font-weight:700>return</span> lastName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1>void</span> <span style=color:#88c0d0>setLastname</span><span style=color:#eceff4>(</span>String lastName<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>lastName</span><span style=color:#81a1c1>=</span>lastName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>To easily perform CRUD operations for our Person we need a repository.
Here&rsquo;s one that uses <a href=https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html>PagingAndSortingRepository</a> from <a href=https://projects.spring.io/spring-data/>spring data</a>.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.data.repository.PagingAndSortingRepository</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.data.repository.query.Param</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.data.rest.core.annotation.RepositoryRestResource</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>java.util.List</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@RepositoryRestResource</span><span style=color:#eceff4>(</span>collectionResourceRel <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#34;people&#34;</span><span style=color:#eceff4>,</span> path <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#34;people&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>interface</span> <span style=color:#8fbcbb>PersonRepository</span> <span style=color:#81a1c1;font-weight:700>extends</span> PagingAndSortingRepository <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      List <span style=color:#88c0d0>findByLastName</span><span style=color:#eceff4>(</span><span style=color:#d08770>@Param</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;name&#34;</span><span style=color:#eceff4>)</span> String name<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>JPA-wise the last thing we need is to include some <a href=https://www.microsoft.com/en-us/sql-server/sql-server-2017>microsoft sql server</a> specifc configuration in our application.properties:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>spring.jpa.hibernate.ddl-auto=create-drop
</span></span><span style=display:flex><span>spring.jpa.show-sql=true
</span></span><span style=display:flex><span>spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect
</span></span><span style=display:flex><span>spring.jpa.database-platform=org.hibernate.dialect.SQLServerDialect
</span></span><span style=display:flex><span>spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults = false
</span></span></code></pre></td></tr></table></div></div><p>And now we are done! Wait, how do we make the application talk to our sql server?</p><h2 id=adding-the-service-catalog-connector>Adding the service catalog connector
<a class=heading-link href=#adding-the-service-catalog-connector><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>We just need to add the connector to the class path:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>          <span style=color:#81a1c1>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1>&lt;groupId&gt;</span>me.snowdrop<span style=color:#81a1c1>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1>&lt;artifactId&gt;</span>servicecatalog-connector<span style=color:#81a1c1>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1>&lt;version&gt;</span>0.0.2<span style=color:#81a1c1>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>And also create a simple bean for our DataSource:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.cloud.config.java.AbstractCloudConfig</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.context.annotation.Bean</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.springframework.context.annotation.Configuration</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.sql.DataSource</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d08770>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>CloudConfig</span> <span style=color:#81a1c1;font-weight:700>extends</span> AbstractCloudConfig <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>public</span> DataSource <span style=color:#88c0d0>dataSource</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>       <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>connectionFactory</span><span style=color:#eceff4>().</span><span style=color:#8fbcbb>service</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;mymssql&#34;</span><span style=color:#eceff4>,</span> DataSource<span style=color:#eceff4>.</span><span style=color:#8fbcbb>class</span><span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This bean does all the dirty work for us. It detects the service instance, gets the binding of the instance and from there reads the secret that contains all connection details. Last but not least it used those details to create the Datasource that the application needs.</p><p>Magic !!!</p><h2 id=deploying-the-application>Deploying the application
<a class=heading-link href=#deploying-the-application><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This is easily accomplished with f-m-p:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mvn clean package fabric8:resources fabric8:package fabric8:deploy
</span></span></code></pre></td></tr></table></div></div><h2 id=testing-the-integration>Testing the integration
<a class=heading-link href=#testing-the-integration><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now, we should be able to create a person using `curl`:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -i -X POST -H <span style=color:#a3be8c>&#34;Content-Type:application/json&#34;</span> -d <span style=color:#a3be8c>&#34;{  \&#34;firstName\&#34; : \&#34;John\&#34;,  \&#34;lastName\&#34; : \&#34;Doe\&#34; }&#34;</span> <span style=color:#a3be8c>`</span>oc get endpoints <span style=color:#eceff4>|</span> grep demo <span style=color:#eceff4>|</span> awk -F <span style=color:#a3be8c>&#34; &#34;</span> <span style=color:#a3be8c>&#39;{print $2}&#39;</span><span style=color:#a3be8c>`</span>/people
</span></span></code></pre></td></tr></table></div></div><p>The command above gets the endpoint of our demo application and uses that in order to perform a curl. I used direct access to the endpoint as it something that works with `oc cluster up` without requiring much additional configuration. If you have a simpler approach feel free to provide some feedback.</p><p>Note: that the command is referring to `demo` as this was the mame of choice when generating the application. If you used something else you&rsquo;ll need to align.</p><h2 id=epilogue>Epilogue
<a class=heading-link href=#epilogue><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I hope you found that useful. Feel free to give a glimpse at: <a href=https://spring.io/guides/gs/accessing-data-rest>https://spring.io/guides/gs/accessing-data-rest</a> which was used as a reference in this post.</p><p>Enjoy!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2024
Ioannis Canellos
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>