<!doctype html><html lang=en><head><title>Language Server Protocol, Java and Emacs · Ioannis Canellos - My Blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Ioannis Canellos"><meta name=description content="Prologue Link to heading Lately I keep hearing about &ldquo;how much software development has changed over the last half of the decade&rdquo;. This usually refers to the adoption of containers, cloud etc. I would like to focus on an other factor of the change and that is the plethora of development related systems and services.
So its typical for a team to have:
version control code review systems code analysis systems project management issue trackers continuous integration chat / messaging Add email to that and you realize that most of development related tasks now days take place in the browser."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Language Server Protocol, Java and Emacs"><meta name=twitter:description content="Prologue Link to heading Lately I keep hearing about &ldquo;how much software development has changed over the last half of the decade&rdquo;. This usually refers to the adoption of containers, cloud etc. I would like to focus on an other factor of the change and that is the plethora of development related systems and services.
So its typical for a team to have:
version control code review systems code analysis systems project management issue trackers continuous integration chat / messaging Add email to that and you realize that most of development related tasks now days take place in the browser."><meta property="og:title" content="Language Server Protocol, Java and Emacs"><meta property="og:description" content="Prologue Link to heading Lately I keep hearing about &ldquo;how much software development has changed over the last half of the decade&rdquo;. This usually refers to the adoption of containers, cloud etc. I would like to focus on an other factor of the change and that is the plethora of development related systems and services.
So its typical for a team to have:
version control code review systems code analysis systems project management issue trackers continuous integration chat / messaging Add email to that and you realize that most of development related tasks now days take place in the browser."><meta property="og:type" content="article"><meta property="og:url" content="https://iocanel.github.io/2018/06/language-server-protocol-java-and-emacs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-20T19:00:00+03:00"><meta property="article:modified_time" content="2018-06-20T19:00:00+03:00"><link rel=canonical href=https://iocanel.github.io/2018/06/language-server-protocol-java-and-emacs/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.123.6"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Ioannis Canellos - My Blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://iocanel.github.io/2018/06/language-server-protocol-java-and-emacs/>Language Server Protocol, Java and Emacs</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-06-20T19:00:00+03:00>June 20, 2018
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
6-minute read</span></div></div></header><div><h2 id=prologue>Prologue
<a class=heading-link href=#prologue><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Lately I keep hearing about &ldquo;how much software development has changed over the last half of the decade&rdquo;.
This usually refers to the adoption of containers, cloud etc. I would like to focus on an other factor of the change and that is the plethora of development related systems and services.</p><p>So its typical for a team to have:</p><ul><li>version control</li><li>code review systems</li><li>code analysis systems</li><li>project management</li><li>issue trackers</li><li>continuous integration</li><li>chat / messaging</li></ul><p>Add email to that and you realize that most of development related tasks now days take place in the browser.
Unfortunately, browsers by nature are unaware of the content they serve, so its not trivial to automate your workflow in the browser.
So, if the browser is not going to play the role of &lsquo;Swiss army knife&rsquo; for development then what?</p><p>One could put all hopes in modern IDEs, however IDEs tend to be specialized more on language features and less about integration with external systems and services.
The later is usually a space where general purpose editors are better. And that is mostly because the have a wider and more uniform audience.
On the other hand these editors are not so rich in language related features.</p><p>So a big question is &ldquo;Will editors like Atom, Emacs or Visual Studio Code ever be competitive to traditional IDEs for writing code?&rdquo;
At least for Java developers, this used to be a &ldquo;not viable option&rdquo;.</p><p>This is something that is going to change, due to the `Language Server Protocol`.</p><h2 id=what-is-the-language-server-protocol>What is the language server protocol?
<a class=heading-link href=#what-is-the-language-server-protocol><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><a href=https://microsoft.github.io/language-server-protocol>LSP</a> is a standardized protocol for how &ldquo;language servers&rdquo; and &ldquo;development tools&rdquo; communicate.
A language server implements all the language specific operations once and then different development tools can connect to it and get the functionality for free.</p><p>So, if I create a new language say &ldquo;AwesomeScript&rdquo;, instead of creating support for all editors out there, I&rsquo;ll just need to implement the language server once.
Then I would just need to write just a little bit of code for each editor (if any at all), to hook to the &ldquo;language server&rdquo;.</p><h2 id=the-history-of-language-servers>The history of language servers
<a class=heading-link href=#the-history-of-language-servers><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Traditional editors like <a href=https://www.gnu.org/software/emacs/>Emacs</a> or <a href=https://www.vim.org/>vim</a> have been using language servers for a while now. Some examples that come to mind are:</p><ul><li><a href=https://ensime.github.io/>Ensime</a></li><li><a href=http://eclim.org/>Eclim</a></li><li><a href=https://github.com/mopemope/meghanada-server>Meghanada</a></li></ul><p>There was no standard protocol at that time (though there were visible similarities). The effort of standardization was initiated by Microsoft, as they starting
implementing one server after the other for the needs of <a href=https://code.visualstudio.com/>visual studio code</a>.
<a href=https://github.com/Microsoft/language-server-protocol/wiki/Protocol-History>More details on LSP history</a>.</p><h2 id=language-server-protocol-and-java>Language Server Protocol and Java
<a class=heading-link href=#language-server-protocol-and-java><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I&rsquo;ve been writing Java for more than 15 years now. For nearly a decade I&rsquo;ve been exclusively using <a href=https://www.jetbrains.com/idea/>Intellij</a> for Java development. For everything else my goto editor has been <a href=https://www.gnu.org/software/emacs/>Emacs</a> (at least the last year or so).
So, it made sense for me to experiment with LSP on Emacs and see how far can I get.</p><h3 id=eclipse-java-language-server>Eclipse Java Language Server
<a class=heading-link href=#eclipse-java-language-server><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>For Java the most popular implementation of the protocol is <a href=https://github.com/eclipse/eclipse.jdt.ls>Eclipse Java Language Server</a>. At this point I have to clarify that I&rsquo;ve never managed to productively use the <a href=https://www.eclipse.org/>Eclipse IDE</a>. It always felt that it required
a lot of manual configuration and tuning for things (e.g. maven support, apt and more) that other alternatives provided out of the box.</p><figure><img src=images/jdt-ls.png></figure><p>The initial experience exceeded my expectations.</p><ul><li>It was a lot faster than <a href=http://eclim.org/>Eclim</a>.</li><li>Navigating the code was working great.</li><li>Functionality provided by <a href=https://github.com/emacs-lsp/lsp-ui>lsp-ui</a> worked surprisingly well (sideline, doc etc).</li><li>It gave me access to some simple refactoring tasks(see the image above).</li></ul><p>Unfortunately, sooner or later the experience became way too Eclipsy for my taste.
What do I mean by that?
When added things like annotation processors etc into the mix, I started having issues that my &ldquo;Google Fu&rdquo; wasn&rsquo;t able to overcome in the little time I had &mldr;
&mldr; or I am just not used in the &ldquo;Eclipse&rdquo; way of things and didn&rsquo;t want to put the extra effort &mldr;
&mldr; or a little bit of both?</p><h3 id=intellij-language-server>IntelliJ Language Server
<a class=heading-link href=#intellij-language-server><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Here&rsquo;s where <a href=https://microsoft.github.io/language-server-protocol>LSP</a> becomes really interesting&mldr;</p><p>I recently bumped into a project called <a href=https://github.com/Ruin0x11/intellij-lsp-server>Intellij LSP Server</a>, that actually provided an <a href=https://www.jetbrains.com/idea/>Intellij</a> plugin that exposed the IDEs capabilities through LSP. This made it possible to use it as a drop in replacement of <a href=https://github.com/eclipse/eclipse.jdt.ls>Eclipse Java Language Server</a>.
So, I could get all the <a href=https://github.com/emacs-lsp/lsp-ui>lsp-ui</a> related stuff for free but with added <a href=https://www.jetbrains.com/idea/>Intellij</a> coolness.</p><p>It was a blast! It provided everything that <a href=https://github.com/eclipse/eclipse.jdt.ls>Eclipse Java Language Server</a> did, but with:</p><ul><li>way better completion that was in par with <a href=https://www.jetbrains.com/idea/>Intellij</a>.</li><li>Better &ldquo;run project&rdquo; functionality.</li></ul><p>Here&rsquo;s how completion looks:</p><figure><img src=images/lsp-intellij-completion.png></figure><p>And here&rsquo;s how the <a href=https://github.com/emacs-lsp/lsp-ui>lsp-ui</a> stuff work with <a href=https://github.com/Ruin0x11/intellij-lsp-server>Intellij LSP Server</a>:</p><figure><img src=images/lsp-intellij-ui.png></figure><p>The only downside for this project is that its still in alpha state and in many cases the server dies or blocks for user input.</p><p>Here&rsquo;s an example:</p><h4 id=file-cache-conflict>File Cache Conflict
<a class=heading-link href=#file-cache-conflict><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>When <a href=https://www.jetbrains.com/idea/>Intellij</a> detects that a file has been externally modified it opens up a pop-up that prompts the user to select if it should reload from disk or use the cached version.
When this dialog gets popped all the <a href=https://microsoft.github.io/language-server-protocol>LSP</a> operations are blocked. As there seems no obvious way to disable it I hacked a little bash script to automatically click the button for me without leaving my editor:</p><p>The script searches for a window titled &ldquo;File Cache Conflict&rdquo; and when it does, it focuses on it and sends the space key event.
This accepts the default suggestion which is &ldquo;Load from file system&rdquo;.
Finally, it switches back to my editor workspace (As an <a href=https://i3wm.org/>i3 window manager</a> user, I run <a href=https://www.jetbrains.com/idea/>Intellij</a> on workspace 4 and <a href=https://www.gnu.org/software/emacs/>Emacs</a> on workspace 2).</p><p>Here&rsquo;s how the script looks like:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5e81ac;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#5e81ac;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>function</span> get-file-cache-conflict-window <span style=color:#81a1c1>{</span>
</span></span><span style=display:flex><span>    xdotool search <span style=color:#a3be8c>&#34;File Cache Conflict&#34;</span> 2&gt; /dev/null
</span></span><span style=display:flex><span><span style=color:#81a1c1>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>function</span> <span style=color:#81a1c1;font-weight:700>return</span>-to-workspace <span style=color:#81a1c1>{</span>
</span></span><span style=display:flex><span>    xdotool key --clearmodifiers Super_L+2
</span></span><span style=display:flex><span><span style=color:#81a1c1>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>window<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>$(</span>get-file-cache-conflict-window<span style=color:#81a1c1;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#81a1c1>[</span> -n <span style=color:#a3be8c>&#34;</span>$window<span style=color:#a3be8c>&#34;</span> <span style=color:#81a1c1>]</span><span style=color:#eceff4>;</span> <span style=color:#81a1c1;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>echo</span> <span style=color:#a3be8c>&#34;Switching to window </span>$window<span style=color:#a3be8c>.&#34;</span>
</span></span><span style=display:flex><span>    xdotool windowactivate --sync $window
</span></span><span style=display:flex><span>    sleep 0.1
</span></span><span style=display:flex><span>    xdotool key --clearmodifiers space
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span>-to-workspace
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>Unfortunately, there are other issues like that, that can leave you wondering why things stopped working, but I hope that they will get resolved soon, as I really like the project.</p><h2 id=honorable-mention-meghanada>Honorable Mention: Meghanada
<a class=heading-link href=#honorable-mention-meghanada><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><a href=https://github.com/mopemope/meghanada-server>Meghanada</a> is not using the <a href=https://microsoft.github.io/language-server-protocol>LSP</a> so I want get into much details about it. I will just say that it did work pretty well for me and my only complaint is that completion requires improvements.
Also, it worth mentioning that the maintainer is on fire and he fixes things really fast.</p><h2 id=debug-protocol>Debug Protocol
<a class=heading-link href=#debug-protocol><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I recently found out that in the same spirit there is an effort about a Debug protocol. This is also something really needed if one is to move from a specialized IDE to a general purpose editor.</p><h2 id=closing-thoughts>Closing thoughts
<a class=heading-link href=#closing-thoughts><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I am really excited about <a href=https://microsoft.github.io/language-server-protocol>LSP</a>. I feel that it will provide additional freedom in tool/workflow selection.
Also, I think that it will play a very important role in initiatives like <a href=https://www.eclipse.org/che/>Eclipse Che</a> or other Cloud IDEs.</p><p>For now, I am sticking to my IDE, but I will continue to experiment <a href=https://microsoft.github.io/language-server-protocol>LSP</a> as I truly believe in the potential of fully programmable editors.
I intend to write more on this subject and maybe even create a demo.</p><p>I am interested in hearing about your setup, your experiences or any suggestion, so please do leave a comment!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2024
Ioannis Canellos
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>