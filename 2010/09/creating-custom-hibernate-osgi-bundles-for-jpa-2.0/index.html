<!doctype html><html lang=en><head><title>Creating custom Hibernate OSGI bundles for JPA 2.0 · Ioannis Canellos - My Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Ioannis Canellos"><meta name=description content="Prologue Link to heading Karaf 2.1.0 has been just released! Among other new features, it includes a major revamp in the JAAS module support:
Encryption support Database Login Module Role Policies This post will use all 3 features, in order to create a secured Wicket application on Karaf, using Karaf’s JAAS modules and Wicket’s auth-roles module.
Introduction Link to heading The application that we are going to build is a simple wicket application."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating custom Hibernate OSGI bundles for JPA 2.0"><meta name=twitter:description content="Prologue Link to heading Karaf 2.1.0 has been just released! Among other new features, it includes a major revamp in the JAAS module support:
Encryption support Database Login Module Role Policies This post will use all 3 features, in order to create a secured Wicket application on Karaf, using Karaf’s JAAS modules and Wicket’s auth-roles module.
Introduction Link to heading The application that we are going to build is a simple wicket application."><meta property="og:title" content="Creating custom Hibernate OSGI bundles for JPA 2.0"><meta property="og:description" content="Prologue Link to heading Karaf 2.1.0 has been just released! Among other new features, it includes a major revamp in the JAAS module support:
Encryption support Database Login Module Role Policies This post will use all 3 features, in order to create a secured Wicket application on Karaf, using Karaf’s JAAS modules and Wicket’s auth-roles module.
Introduction Link to heading The application that we are going to build is a simple wicket application."><meta property="og:type" content="article"><meta property="og:url" content="https://iocanel.github.io/2010/09/creating-custom-hibernate-osgi-bundles-for-jpa-2.0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-09-25T00:00:00+03:00"><meta property="article:modified_time" content="2010-09-25T00:00:00+03:00"><link rel=canonical href=https://iocanel.github.io/2010/09/creating-custom-hibernate-osgi-bundles-for-jpa-2.0/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.105.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Ioannis Canellos - My Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://iocanel.github.io/2010/09/creating-custom-hibernate-osgi-bundles-for-jpa-2.0/>Creating custom Hibernate OSGI bundles for JPA 2.0</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2010-09-25T00:00:00+03:00>September 25, 2010</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div></div></header><div><h2 id=prologue>Prologue
<a class=heading-link href=#prologue><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Karaf 2.1.0 has been just released! Among other new features, it includes a major revamp in the JAAS module support:</p><ul><li>Encryption support</li><li>Database Login Module</li><li>Role Policies</li></ul><p>This post will use all 3 features, in order to create a secured Wicket application on Karaf, using Karaf’s JAAS modules and Wicket’s auth-roles module.</p><h2 id=introduction>Introduction
<a class=heading-link href=#introduction><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The application that we are going to build is a simple wicket application. It will be deployed on Karaf and the user credentials will be stored in a mysql database. For encrypting the password we will use Karaf’s Jasypt encryption service implementation, to encrypt passwords using MD5 algorithm in hexadecimal format.</p><h2 id=step-1-creating-the-database>Step 1: Creating the database
<a class=heading-link href=#step-1-creating-the-database><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The database that we are going to create will the simplest possible. We need a table that will hold username and password for each user. Each user may have one or more roles, so we will need a new table to hold the roles of the users.</p><p>We are going to create a user named “iocanel“, that will have the roles “manager” and “admin” and password “koala” (stored in MD5 with hex output).</p><p>Note, for cases that a schema for user credentials already exists, Karaf’s database login module offer’s customization by allowing the user to provide custom queries for password and role retrieval.</p><h2 id=step-2-creating-a-data-source>Step 2: Creating a data source
<a class=heading-link href=#step-2-creating-a-data-source><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In order to create a data source we will use the blueprint to create a DataSource as an OSGi service.
Before we do that we will need to install the mysql bundle and its prerequisite.
They can be easily installed from karaf shell.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>osgi:install wrap:mvn:javax.xml.stream/stax-api/1.0
</span></span><span style=display:flex><span>osgi:install wrap:mvn:mysql/mysql-connector-java/5.1.13
</span></span></code></pre></td></tr></table></div></div><p>Once all prerequisites are meet the datasource can be created by dropping the following xml under karaf deploy folder or by adding it under OSGI-INF/blueprint folder of our bundle.</p><h2 id=step-3-creating-a-jaas-realm>Step 3: Creating a JAAS realm
<a class=heading-link href=#step-3-creating-a-jaas-realm><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In the same manner the new JAAS realm can be created by dropping the blueprint xml under the deploy folder or by adding it under OSGI-INF/blueprint folder of our bundle.</p><p>The new realm will make use of Karaf’s JDBCLoginModule, and will also use MD5 encryption with hexadecimal output. Finally, it will be passed a role policy, that will add the “ROLE_” prefix on all role principals. This way our application can identify the role principals, without depending to the Karaf implementation.</p><p>If this isn’t that clear, note that JAAS specifies interface Principal and its implementations provide User & Role principals (as implementing classes), making it impossible to distinguish between these two without having a dependency to the JAAS implementation or by having a common convention. This is what Role Policies is about.</p><h2 id=step-4-creating-a-wicket-application>Step 4: Creating a wicket application
<a class=heading-link href=#step-4-creating-a-wicket-application><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Everything is set and all we need is to create the wicket application that will make use of our new JAAS realm in order to authenticate.</p><p>The first step is to create a Wicket Authenticated Session:</p><p>Now we need to tell our application to create such sessions and also where the location of our sign in page will be. For this purpose we will extend Wicket’s AuthenticatedWebApplication class:
Now that everything is set up, we can restrict access to the HomePage to “admins” and “managers” by making use of Wickets</p><h2 id=final-words>Final Words
<a class=heading-link href=#final-words><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I hope you found it useful. The source of this example will be added to this post soon, so stay tuned.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2022
Ioannis Canellos
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>