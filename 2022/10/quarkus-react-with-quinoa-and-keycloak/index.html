<!doctype html><html lang=en><head><title>Quarkus React with Quinoa and Keycloak Â· Ioannis Canellos - My Blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Ioannis Canellos"><meta name=description content="How to create Quarkus powered react applications that use Keycloak via DevServices"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Quarkus React with Quinoa and Keycloak"><meta name=twitter:description content="How to create Quarkus powered react applications that use Keycloak via DevServices"><meta property="og:title" content="Quarkus React with Quinoa and Keycloak"><meta property="og:description" content="How to create Quarkus powered react applications that use Keycloak via DevServices"><meta property="og:type" content="article"><meta property="og:url" content="https://iocanel.github.io/2022/10/quarkus-react-with-quinoa-and-keycloak/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-17T14:36:00+03:00"><meta property="article:modified_time" content="2022-10-17T14:36:00+03:00"><link rel=canonical href=https://iocanel.github.io/2022/10/quarkus-react-with-quinoa-and-keycloak/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.123.6"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Ioannis Canellos - My Blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://iocanel.github.io/2022/10/quarkus-react-with-quinoa-and-keycloak/>Quarkus React with Quinoa and Keycloak</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-10-17T14:36:00+03:00>October 17, 2022
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
11-minute read</span></div></div></header><div><h2 id=introduction>Introduction
<a class=heading-link href=#introduction><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This year I decided to put some personal time in learning <a href=https://reactjs.org/>reactjs</a>. While I enjoy using Javascript for the frontend, I&rsquo;d say that it&rsquo;s not the language of choice for me for backend use.
I don&rsquo;t have anything against <a href=https://nodejs.org>nodejs</a>, but I prefer use java frameworks, which is the focus of my day job. So, I wanted to combine <a href=https://reactjs.org/>reactjs</a> with <a href=https://quarkus.io/>Quarkus</a>. A combination that just became
more fun with the <a href=https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/>Quinoa</a>. <a href=https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/>Quinoa</a> allows users to use their favorite javascript framework with <a href=https://quarkus.io/>Quarkus</a> with no additional configuration. On top of that it allows development of both
backend and fronted from via the <a href=https://quarkus.io/>Quarkus</a> dev mode. Last but not least it allows for native compilation that produces a single binary containing both fronted and backend.</p><p>This post demonstrates development using <a href=https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/>Quinoa</a>. To make things more interesting it adds security into the mix. In particular it uses <a href=https://www.keycloak.org/>Keycloak</a> as an identity provider and shows how
frontend and backend can exchange information is a secure way.</p><p>The end result is something like:</p><figure><img src=home.png></figure><p>The full project can be found at: <a href=https://github.com/iocanel/quarkus-react-keycloak>https://github.com/iocanel/quarkus-react-keycloak</a></p><p><strong>Credits:</strong> The following demo <a href=https://github.com/dasniko/keycloak-reactjs-demo>https://github.com/dasniko/keycloak-reactjs-demo</a> by <a href=https://github.com/dasniko>Niko Kobler</a> was really helpful and influencial for this post.</p><h2 id=challenges>Challenges
<a class=heading-link href=#challenges><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The main challenges that such a setup faces and addressed in this blog are:</p><ul><li>Starting <a href=https://www.keycloak.org/>Keycloak</a> dev service configured with a public client (for frontend use).</li><li><a href=https://www.keycloak.org/>Keycloak</a> discovery from the frontend.</li><li>Frontend/backend communication using the token obtained from <a href=https://www.keycloak.org/>Keycloak</a></li></ul><h2 id=getting-started-with-quinoa>Getting started with Quinoa
<a class=heading-link href=#getting-started-with-quinoa><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To create an empty <a href=https://quarkus.io/>Quarkus</a> project using the <a href=https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/>Quinoa</a> extension:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mkdir -p ~/demo
</span></span><span style=display:flex><span><span style=color:#81a1c1>cd</span> ~/demo
</span></span><span style=display:flex><span>quarkus create app quarkus-react-keycloak -x<span style=color:#81a1c1>=</span>io.quarkiverse.quinoa:quarkus-quinoa
</span></span><span style=display:flex><span><span style=color:#81a1c1>cd</span> quarkus-react-keycloak
</span></span></code></pre></td></tr></table></div></div><p>The generated project has the structure shown below. It&rsquo;s a regular <a href=https://quarkus.io/>Quarkus</a> application with the addition of `webui` under `src/main`:</p><figure><img src=project-structure.png></figure><p>The `webui` folder is a traditional Javascript project.</p><h2 id=add-the-extensions-for-keycloak>Add the extensions for keycloak
<a class=heading-link href=#add-the-extensions-for-keycloak><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To be able to access the <a href=https://www.keycloak.org/>Keycloak</a> Dev Services, we&rsquo;ll need the following extension.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>quarkus ext add -B oidc
</span></span><span style=display:flex><span>quarkus ext add -B keycloak-authorization
</span></span></code></pre></td></tr></table></div></div><p>Now, by running the application in dev mode, the <a href=https://www.keycloak.org/>Keycloak</a> Dev Service is automatically started:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./mvnw quarkus:dev
</span></span></code></pre></td></tr></table></div></div><h2 id=exposing-keycloak-to-the-fronted>Exposing Keycloak to the fronted
<a class=heading-link href=#exposing-keycloak-to-the-fronted><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The Dev Service for <a href=https://www.keycloak.org/>Keycloak</a> passes as properties all configuration information needed for interaction with the service.
The fronted however, is completely unaware. Let&rsquo;s expose the information via rest. So, let&rsquo;s add the `quarkus-resteasy-reactive-jackson` extension:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>quarkus ext add -B resteasy-reactive-jackson
</span></span></code></pre></td></tr></table></div></div><p>Now, let&rsquo;s add a resource that exposes <a href=https://www.keycloak.org/>Keycloak</a> information.
The info we need to expose is:</p><ul><li>The url</li><li>The realm</li><li>The clientId</li></ul><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> <span style=color:#8fbcbb>org.acme</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>KeycloakInfo</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#81a1c1;font-weight:700>private</span> <span style=color:#81a1c1;font-weight:700>final</span> String url<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>     <span style=color:#81a1c1;font-weight:700>private</span> <span style=color:#81a1c1;font-weight:700>final</span> String realm<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>     <span style=color:#81a1c1;font-weight:700>private</span> <span style=color:#81a1c1;font-weight:700>final</span> String clientId<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#88c0d0>KeycloakInfo</span><span style=color:#eceff4>(</span>String url<span style=color:#eceff4>,</span> String realm<span style=color:#eceff4>,</span> String clientId<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>url</span> <span style=color:#81a1c1>=</span> url<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>realm</span> <span style=color:#81a1c1>=</span> realm<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>clientId</span> <span style=color:#81a1c1>=</span> clientId<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getUrl</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>return</span> url<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getRealm</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>return</span> realm<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getClientId</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1;font-weight:700>return</span> clientId<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In theory we can live with just the `url` (it&rsquo;s the only thing that is dynamic) and hardcode the rest in fronted.
Let&rsquo;s create a rest resource that uses the path `/api/keycloak/info.json` to expose the `Keycloak` info.
That resource obtains the `url`, and `clientId` from the configuration populated by the Dev Service using the `@ConfigurationProperty` annotation.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> <span style=color:#8fbcbb>org.acme</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.GET</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.Path</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.Produces</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.core.MediaType</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.eclipse.microprofile.config.inject.ConfigProperty</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d08770>@Path</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;/api/keycloak&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>KeycloakResource</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@ConfigProperty</span><span style=color:#eceff4>(</span>name<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;keycloak.url&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  String keycloakUrl<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  String realm<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;quarkus&#34;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@ConfigProperty</span><span style=color:#eceff4>(</span>name<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;quarkus.oidc.client-id&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  String clientId<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@GET</span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@Path</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;info.json&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  <span style=color:#d08770>@Produces</span><span style=color:#eceff4>(</span>MediaType<span style=color:#eceff4>.</span><span style=color:#8fbcbb>APPLICATION_JSON</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>public</span> KeycloakInfo <span style=color:#88c0d0>getInfo</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>new</span> KeycloakInfo<span style=color:#eceff4>(</span>keycloakUrl<span style=color:#eceff4>,</span> realm<span style=color:#eceff4>,</span> clientId<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>By accessing <a href=http://localhost:8080/api/keycloak/info.json>http://localhost:8080/api/keycloak/info.json</a> you get something similar to:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span> <span style=color:#bf616a>url:</span> <span style=color:#81a1c1>&#34;http://localhost:43749&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span> <span style=color:#bf616a>realm:</span> <span style=color:#81a1c1>&#34;quarkus&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span> <span style=color:#bf616a>clientId:</span> <span style=color:#81a1c1>&#34;quarkus-app&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Before demonstrating what exactly we are going to do with this blob of json in the frontend, let&rsquo;s configure which paths served by the front and which by the backend.</p><h2 id=single-application-routing>Single application routing
<a class=heading-link href=#single-application-routing><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To configure the routes served by the backend, let&rsquo;s set `quarkus.quinoa.enable-spa-routing` to true.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#81a1c1>echo</span> <span style=color:#a3be8c>&#34;quarkus.quinoa.enable-spa-routing=true&#34;</span> &gt;&gt; src/main/resources/application.properties
</span></span></code></pre></td></tr></table></div></div><h2 id=setup-the-react-application>Setup the react application
<a class=heading-link href=#setup-the-react-application><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s just delete the `webui` folder for now and create a new <a href=https://reactjs.org/>reactjs</a> application from scratch:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>rm -r src/main/webui
</span></span><span style=display:flex><span><span style=color:#81a1c1>cd</span> src/main
</span></span><span style=display:flex><span>yarn create react-app webui
</span></span><span style=display:flex><span><span style=color:#81a1c1>cd</span> webui
</span></span></code></pre></td></tr></table></div></div><p>An alternative is to use a react template. I usually go with <a href=https://github.com/iotemplates/react-template>https://github.com/iotemplates/react-template</a> which is a simple todo app
and is setup with tests, github actions etc.</p><h2 id=add-dependencies>Add dependencies
<a class=heading-link href=#add-dependencies><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>We need two additional dependencies:</p><ul><li><a href=https://github.com/axios/axios>axios</a></li><li><a href=http://keycloak.org>keycloak-js</a><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  npm install --save axios
</span></span><span style=display:flex><span>  npm install --save keycloak-js
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=configuring-the-keycloak-client-in-javascript>Configuring the Keycloak client in Javascript
<a class=heading-link href=#configuring-the-keycloak-client-in-javascript><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To initialize the <a href=https://www.keycloak.org/>keycloak</a> javascript client we need to fetch the `info.json` from the backend and pass it to the constructor.
Then it&rsquo;s just a matter of calling the `init` function with the proper configuration:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>let</span> keycloak<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>fetch<span style=color:#eceff4>(</span><span style=color:#a3be8c>`http://localhost:8080/api/keycloak/info.json`</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>.</span>then<span style=color:#eceff4>(</span>response <span style=color:#eceff4>=&gt;</span> response<span style=color:#eceff4>.</span>json<span style=color:#eceff4>()).</span>then<span style=color:#eceff4>(</span>json <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    keycloak <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>new</span> Keycloak<span style=color:#eceff4>(</span>json<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    keycloak<span style=color:#eceff4>.</span>init<span style=color:#eceff4>({</span>
</span></span><span style=display:flex><span>        onLoad<span style=color:#81a1c1>:</span> <span style=color:#a3be8c>&#39;check-sso&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        silentCheckSsoRedirectUri<span style=color:#81a1c1>:</span> <span style=color:#81a1c1>window</span><span style=color:#eceff4>.</span>location<span style=color:#eceff4>.</span>origin <span style=color:#81a1c1>+</span> <span style=color:#a3be8c>&#39;/silent-check-sso.html&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        pkceMethod<span style=color:#81a1c1>:</span> <span style=color:#a3be8c>&#39;S256&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        checkLoginIframe<span style=color:#81a1c1>:</span> <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}};</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>});</span>
</span></span></code></pre></td></tr></table></div></div><p>The java developer in me feels compelled to encapsulate the <a href=https://www.keycloak.org/>keycloak</a> client so, let&rsquo;s wrap it in a class:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">64
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> Keycloak from <span style=color:#a3be8c>&#39;keycloak-js&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>class</span> KeycloakService <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>  <span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  init<span style=color:#eceff4>(</span>onAuthenticated<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    fetch<span style=color:#eceff4>(</span><span style=color:#a3be8c>`http://localhost:8080/api/keycloak/info.json`</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>          <span style=color:#eceff4>.</span>then<span style=color:#eceff4>(</span>response <span style=color:#eceff4>=&gt;</span> response<span style=color:#eceff4>.</span>json<span style=color:#eceff4>()).</span>then<span style=color:#eceff4>(</span>json <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>new</span> Keycloak<span style=color:#eceff4>(</span>json<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>init<span style=color:#eceff4>({</span>
</span></span><span style=display:flex><span>        onLoad<span style=color:#81a1c1>:</span> <span style=color:#a3be8c>&#39;check-sso&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        silentCheckSsoRedirectUri<span style=color:#81a1c1>:</span> <span style=color:#81a1c1>window</span><span style=color:#eceff4>.</span>location<span style=color:#eceff4>.</span>origin <span style=color:#81a1c1>+</span> <span style=color:#a3be8c>&#39;/silent-check-sso.html&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        pkceMethod<span style=color:#81a1c1>:</span> <span style=color:#a3be8c>&#39;S256&#39;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        checkLoginIframe<span style=color:#81a1c1>:</span> <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}).</span>then<span style=color:#eceff4>((</span>authenticated<span style=color:#eceff4>)</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        console<span style=color:#eceff4>.</span>log<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;User:&#34;</span> <span style=color:#81a1c1>+</span> <span style=color:#eceff4>(</span>authenticated <span style=color:#81a1c1>?</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span>getUsername<span style=color:#eceff4>()</span> <span style=color:#81a1c1>:</span> <span style=color:#a3be8c>&#34;anonymous.&#34;</span><span style=color:#eceff4>));</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#eceff4>(</span>onAuthenticated<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>          onAuthenticated<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>}).</span><span style=color:#81a1c1;font-weight:700>catch</span><span style=color:#eceff4>(</span>console<span style=color:#eceff4>.</span>error<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>});</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  login<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>login<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  logout<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>logout<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  updateToken<span style=color:#eceff4>(</span>callback<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>updateToken<span style=color:#eceff4>(</span><span style=color:#b48ead>5</span><span style=color:#eceff4>).</span>then<span style=color:#eceff4>(</span>callback<span style=color:#eceff4>).</span><span style=color:#81a1c1;font-weight:700>catch</span><span style=color:#eceff4>(()</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span>login<span style=color:#eceff4>());</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  getToken<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#81a1c1>?</span><span style=color:#eceff4>.</span>token<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  getUsername<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>idTokenParsed<span style=color:#81a1c1>?</span><span style=color:#eceff4>.</span>upn<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  isAuthenticated<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>!!</span><span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span>getToken<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  hasRole<span style=color:#eceff4>(</span>roles<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> roles<span style=color:#eceff4>.</span>some<span style=color:#eceff4>((</span>role<span style=color:#eceff4>)</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span>getRoles<span style=color:#eceff4>().</span>includes<span style=color:#eceff4>(</span>role<span style=color:#eceff4>));</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>  getRoles<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#bf616a>#</span>keycloak<span style=color:#eceff4>.</span>idTokenParsed<span style=color:#81a1c1>?</span><span style=color:#eceff4>.</span>upn<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>const</span> userService <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>new</span> KeycloakService<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>const</span> getToken <span style=color:#81a1c1>=</span> <span style=color:#eceff4>()</span> <span style=color:#eceff4>=&gt;</span> userService<span style=color:#eceff4>.</span>getToken<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>const</span> updateToken <span style=color:#81a1c1>=</span> <span style=color:#eceff4>(</span>callback<span style=color:#eceff4>)</span> <span style=color:#eceff4>=&gt;</span> userService<span style=color:#eceff4>.</span>updateToken<span style=color:#eceff4>(</span>callback<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>const</span> UserService <span style=color:#81a1c1>=</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>  userService<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  getToken<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  updateToken
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>default</span> UserService<span style=color:#eceff4>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Note, the `login` method. Calling that redirects users to the <a href=https://www.keycloak.org/>Keycloak</a> login screen.</p><p>However, there is a detail that needs shorting out. The client needs to authenticate itself.
Client authenticates with the use of a `clientSecret` or by configuring the <a href=https://www.keycloak.org/>Keycloak</a> realm to allow for public clients.
Given, that we are talking about the fronted, there is not much sense to use a secret so we need to configure the
realm as private.</p><h2 id=configuring-the-realm>Configuring the realm
<a class=heading-link href=#configuring-the-realm><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Out of the box, the <a href=https://www.keycloak.org/>Keycloak</a> Dev Services will create a realm with some sensible defaults. The generated realm however, does not allow public clients and also imposed some limitations on which are the origins allowed to use the service.
Another options is to `bring your own realm`.
The <a href=https://raw.githubusercontent.com/iocanel/quarkus-react-keycloak/main/src/main/resources/quarkus-realm.json>provided realm</a> is ready to use. The only difference from the generated one, are the customization mentioned above. Additional customization is possbile by logging to the <a href=https://www.keycloak.org/>Keycloak</a> instance as admin. The instance itself is accessible through the <a href=https://quarkus.io/>Quarkus</a> Dev UI `<a href=http://localhost:8080/q/dev>http://localhost:8080/q/dev</a>`.</p><figure><img src=dev-console-openid.png></figure><p>By default the admin credentials are `admin` / `admin`.</p><p>After customization, the realm can be exported and passed to the Dev Service configuration.</p><p>In case you provide your own realm, make sure to also set `quarkus.keycloak.devservices.realm-path=` in the `application.properties`.</p><h2 id=the-login-process>The login process
<a class=heading-link href=#the-login-process><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>With the realm properly configured, the `login` method of `KeycloakService` provided above, will bring up the login screen.
<img src=login.png alt></p><p>The <a href=https://raw.githubusercontent.com/iocanel/quarkus-react-keycloak/main/src/main/resources/quarkus-realm.json>provided realm</a> comes with a user named `alice` that use `alice` as a password.</p><p>The only thing left is to configure the <a href=https://reactjs.org/>reactjs</a> routes, so that login initiates, when the user is anonymous and tries to visit protected pages (e.g. `/dashboard` or `profile`). In jsx this is expressed like:</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> BrowserRouter as Router<span style=color:#eceff4>,</span> Routes<span style=color:#eceff4>,</span> Route<span style=color:#eceff4>,</span> Link <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#34;react-router-dom&#34;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>default</span> <span style=color:#81a1c1;font-weight:700>function</span> App<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>&lt;</span>Router<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1>&lt;</span>MenuBar <span style=color:#81a1c1>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1>&lt;</span>Routes<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>Route exact path<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;/&#34;</span> element<span style=color:#81a1c1>=</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>&lt;</span>Home <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>}</span> <span style=color:#81a1c1>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>Route path<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;/dashboard&#34;</span> element<span style=color:#81a1c1>=</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>&lt;</span>PrivateRoute <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>}</span><span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span>Route path<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;/dashboard&#34;</span> element<span style=color:#81a1c1>=</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>&lt;</span>Dashboard <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>}</span> <span style=color:#81a1c1>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/Route&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>Route path<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;/profile&#34;</span> element<span style=color:#81a1c1>=</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>&lt;</span>PrivateRoute <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>}</span><span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span>Route path<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;/profile&#34;</span> element<span style=color:#81a1c1>=</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>&lt;</span>Profile <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>}</span> <span style=color:#81a1c1>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/Route&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/Routes&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/Router&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The code is pretty straight forward, with only exception the `PrivateRoute`. The `PrivateRoute` is custom component that encapsulates
The authentication logic. It uses the `userService` (which is actually the `KeycloakService` implemented previously) to check if user is logged in.
If not, then the login process starts. In the opposite case the `Outlet` is displayed.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> useEffect <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#39;react&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> Outlet <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#39;react-router-dom&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> userService <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#39;../services/UserService&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>default</span> <span style=color:#81a1c1;font-weight:700>function</span> PrivateRoute <span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>  useEffect<span style=color:#eceff4>(()</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#eceff4>(</span><span style=color:#81a1c1>!</span>userService<span style=color:#eceff4>.</span>isAuthenticated<span style=color:#eceff4>())</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>      userService<span style=color:#eceff4>.</span>login<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>},</span> <span style=color:#eceff4>[]);</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>return</span> userService<span style=color:#eceff4>.</span>isAuthenticated<span style=color:#eceff4>()</span> <span style=color:#81a1c1>&amp;&amp;</span> <span style=color:#81a1c1>&lt;</span>Outlet <span style=color:#81a1c1>/&gt;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=secure-frontend-backend-communication>Secure frontend / backend communication
<a class=heading-link href=#secure-frontend-backend-communication><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Securing things only the frontend is no good, if the backend is not.
To secure the backend we need to two things:</p><ul><li>express which users / roles allowed to access which paths.</li><li>pass authentication token obtained by <a href=https://www.keycloak.org/>Keycloak</a> to the backend.</li></ul><p>The former is trivial as <a href=https://quarkus.io/>Quarkus</a> provides the security mechanism to support that.
So, to get the profile information the backend, we can have a resource that allows authenticated users to grab the user info from the `SecurityIdentiy`;</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> <span style=color:#8fbcbb>org.acme</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>java.util.Set</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.annotation.security.RolesAllowed</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.inject.Inject</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.GET</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.Path</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.Produces</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>javax.ws.rs.core.MediaType</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>org.jboss.resteasy.reactive.NoCache</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>io.quarkus.security.identity.SecurityIdentity</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d08770>@Path</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;/api/user&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>UserResource</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@Inject</span>
</span></span><span style=display:flex><span>    SecurityIdentity identity<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@GET</span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@Path</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;/me&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@Produces</span><span style=color:#eceff4>(</span>MediaType<span style=color:#eceff4>.</span><span style=color:#8fbcbb>APPLICATION_JSON</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@RolesAllowed</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;user&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d08770>@NoCache</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>public</span> User <span style=color:#88c0d0>me</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>new</span> User<span style=color:#eceff4>(</span>identity<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>public</span> <span style=color:#81a1c1;font-weight:700>static</span> <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>User</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>private</span> <span style=color:#81a1c1;font-weight:700>final</span> String userName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>private</span> <span style=color:#81a1c1;font-weight:700>final</span> Set<span style=color:#81a1c1>&lt;</span>String<span style=color:#81a1c1>&gt;</span> roles<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        User<span style=color:#eceff4>(</span>SecurityIdentity identity<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>userName</span> <span style=color:#81a1c1>=</span> identity<span style=color:#eceff4>.</span><span style=color:#8fbcbb>getPrincipal</span><span style=color:#eceff4>().</span><span style=color:#8fbcbb>getName</span><span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>this</span><span style=color:#eceff4>.</span><span style=color:#8fbcbb>roles</span> <span style=color:#81a1c1>=</span> identity<span style=color:#eceff4>.</span><span style=color:#8fbcbb>getRoles</span><span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>public</span> String <span style=color:#88c0d0>getUserName</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>return</span> userName<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>public</span> Set<span style=color:#81a1c1>&lt;</span>String<span style=color:#81a1c1>&gt;</span> <span style=color:#88c0d0>getRoles</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>			      <span style=color:#81a1c1;font-weight:700>return</span> roles<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>		    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The other part, requires a little bit work on the frontend side of things so that http request to the backend include the `Bearer` header with
the token as value.</p><p>For http, this blog is using <a href=https://github.com/axios/axios>axios</a>. Let&rsquo;s create a simple factory that creates an <a href=https://github.com/axios/axios>axios</a> client.
The factory uses two callback functions:</p><ul><li>getToken: to fetch the actual token.</li><li>updateToken to update the token</li></ul><p>The factory also defines the interceptor that sets the `Bearer` and refreshes the token when needed.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> axios from <span style=color:#a3be8c>&#34;axios&#34;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>const</span> create <span style=color:#81a1c1>=</span> <span style=color:#eceff4>(</span>getToken<span style=color:#eceff4>,</span> updateToken<span style=color:#eceff4>)</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>const</span> client <span style=color:#81a1c1>=</span> axios<span style=color:#eceff4>.</span>create<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>  client<span style=color:#eceff4>.</span>interceptors<span style=color:#eceff4>.</span>request<span style=color:#eceff4>.</span>use<span style=color:#eceff4>((</span>config<span style=color:#eceff4>)</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>let</span> token <span style=color:#81a1c1>=</span> getToken<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>//Check if authenticated.
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span>    <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#eceff4>(</span>token <span style=color:#81a1c1>!=</span> <span style=color:#81a1c1;font-weight:700>null</span> <span style=color:#81a1c1>&amp;&amp;</span> token<span style=color:#eceff4>.</span>length <span style=color:#81a1c1>&gt;</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1;font-weight:700>const</span> callback <span style=color:#81a1c1>=</span> <span style=color:#eceff4>()</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        config<span style=color:#eceff4>.</span>headers<span style=color:#eceff4>.</span>Authorization <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>`Bearer </span><span style=color:#a3be8c>${</span>getToken<span style=color:#eceff4>()</span><span style=color:#a3be8c>}</span><span style=color:#a3be8c>`</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>Promise</span><span style=color:#eceff4>.</span>resolve<span style=color:#eceff4>(</span>config<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>      <span style=color:#eceff4>};</span>
</span></span><span style=display:flex><span>      updateToken<span style=color:#eceff4>(</span>callback<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> config<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>});</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>return</span> client<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>const</span> AxiosFactory <span style=color:#81a1c1>=</span>  <span style=color:#eceff4>{</span> create <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>export</span> <span style=color:#81a1c1;font-weight:700>default</span> AxiosFactory<span style=color:#eceff4>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=the-profile-component>The profile component
<a class=heading-link href=#the-profile-component><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To demonstrate how the <a href=https://github.com/axios/axios>axios</a> client is used in action let&rsquo;s take a closer look at the profile component.
The component when created, it uses the `AxiosFactory` to create <a href=https://github.com/axios/axios>axios</a>. It passes the token callbacks
provided by the `UserService` shown above. Then it uses the client to fetch users and roles from the `/api/user/me`
that we just coded in the backed.</p><div class=highlight><div style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6c6f74">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> React<span style=color:#eceff4>,</span> useState<span style=color:#eceff4>,</span> useEffect <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#39;react&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>{</span> getToken<span style=color:#eceff4>,</span> updateToken <span style=color:#eceff4>}</span> from <span style=color:#a3be8c>&#39;./services/UserService&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> AxiosFactory from <span style=color:#a3be8c>&#39;./services/AxiosFactory&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>function</span> Profile<span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>const</span> <span style=color:#eceff4>[</span>username<span style=color:#eceff4>,</span> setUsername<span style=color:#eceff4>]</span> <span style=color:#81a1c1>=</span> useState<span style=color:#eceff4>();</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>const</span> <span style=color:#eceff4>[</span>roles<span style=color:#eceff4>,</span> setRoles<span style=color:#eceff4>]</span> <span style=color:#81a1c1>=</span> useState<span style=color:#eceff4>([]);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  useEffect<span style=color:#eceff4>(()</span> <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>const</span> axios <span style=color:#81a1c1>=</span> AxiosFactory<span style=color:#eceff4>.</span>create<span style=color:#eceff4>(</span>getToken<span style=color:#eceff4>,</span> updateToken<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    axios<span style=color:#eceff4>.</span>get<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#39;http://localhost:8080/api/user/me&#39;</span><span style=color:#eceff4>).</span>then<span style=color:#eceff4>(</span>res <span style=color:#eceff4>=&gt;</span> res<span style=color:#eceff4>.</span>data<span style=color:#eceff4>).</span>then<span style=color:#eceff4>(</span>data <span style=color:#eceff4>=&gt;</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>      setUsername<span style=color:#eceff4>(</span>data<span style=color:#eceff4>.</span>userName<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>      setRoles<span style=color:#eceff4>(</span>data<span style=color:#eceff4>.</span>roles<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>});</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>},</span> <span style=color:#eceff4>[]);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>&lt;</span>div<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1>&lt;</span>div<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>h2<span style=color:#81a1c1>&gt;</span>Profile<span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/h2&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>p<span style=color:#81a1c1>&gt;</span>This is the profile page<span style=color:#eceff4>.</span> The purpose <span style=color:#81a1c1;font-weight:700>of</span> the page is to demonstrate how to access a secure resource <span style=color:#81a1c1;font-weight:700>in</span> the backed<span style=color:#eceff4>.</span><span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/p&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>p<span style=color:#81a1c1>&gt;</span>The information below is retrieved via http by passing bearer token retrieved from the user service<span style=color:#eceff4>.</span><span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/p&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>div<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span>label<span style=color:#81a1c1>&gt;</span>Username<span style=color:#81a1c1>:&lt;</span><span style=color:#bf616a>/label&gt; {username}</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/div&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span>div<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span>label<span style=color:#81a1c1>&gt;</span>Roles<span style=color:#81a1c1>:&lt;</span><span style=color:#bf616a>/label&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span>ul<span style=color:#81a1c1>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#eceff4>{</span>roles<span style=color:#eceff4>.</span>map<span style=color:#eceff4>(</span>role <span style=color:#eceff4>=&gt;</span> <span style=color:#81a1c1>&lt;</span>li<span style=color:#81a1c1>&gt;</span><span style=color:#eceff4>{</span>role<span style=color:#eceff4>}</span><span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/li&gt;)}</span>
</span></span><span style=display:flex><span>          <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/ul&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/div&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/div&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>&lt;</span><span style=color:#bf616a>/div&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>);</span>
</span></span></code></pre></td></tr></table></div></div><p>The page should look like:</p><figure><img src=profile.png></figure><h2 id=closing-thoughts>Closing Thoughts
<a class=heading-link href=#closing-thoughts><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Using <a href=https://quarkus.io/>Quarkus</a> with <a href=https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/>Quinoa</a> simplifies working with javascript framework a lot as it uses a single project, build tool and development to work with everything.
Dev Services further simplifies integration with external services, as developers no longer have to setup services by hand, docker compose etc.
<a href=https://www.keycloak.org/>Keycloak</a> provides a great way to deal with authentication, token etc by lifting that burden of the developers shoulder.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>Â©
2019 -
2024
Ioannis Canellos
Â·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>